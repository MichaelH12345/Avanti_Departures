<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-ascale=1.0">
    <title>Background Iframe</title>
    <style>
        /* Font imports */
        @font-face {
            font-family: 'AvertaBold';
            src: url('https://raw.githubusercontent.com/MichaelH12345/Avanti_Departures/main/AvertaBold.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'Averta';
            src: url('https://raw.githubusercontent.com/MichaelH12345/Avanti_Departures/main/Averta.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'Thin Averta';
            src: url('https://raw.githubusercontent.com/MichaelH12345/fonts/main/averta_bigfontsite.com.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'Operator Font';
            src: url('https://raw.githubusercontent.com/MichaelH12345/Avanti_Departures/main/Averta.ttf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

        /* Clock styles */
        .clock {
            position: absolute;
            bottom: -0.5px; /* 3 pixels from the bottom */
            right: 35px; /* 35 pixels from the right */
            font-family: 'AvertaBold', sans-serif;
            font-size: 80px;
            color: white;
            z-index: 5; /* Ensure the clock appears above other elements */
        }

        /* Text box for Departures */
        .text-box {
            position: absolute;
            left: 90px; /* Start 60 pixels from the very left */
            top: 5px; /* 5 pixels from the very top */
            font-family: 'AvertaBold', sans-serif; /* Specify the font */
            font-size: 70px; /* Text size */
            color: white;
            height: auto; /* Set height to auto initially */
        }

.reason {
    text-align: left;
}
        /* Box styles */
        .box {
            position: absolute;
            bottom: 0; /* Start from the very bottom */
            right: 20; /* Start from the very right */
            height: 95px;
            width: 350px;
            background-color: #141d2c; /* Background color */
            z-index: 4; /* Ensure the clock appears above other elements */
        }

        /* Red box styles */
        .red-box {
            position: absolute;
            bottom: 0; /* Start from the very bottom */
            right: 0; /* Start from the very right */
            height: 95px;
            width: 50px; /* Set width to 50 pixels */
            background-color: #FF4713; /* Red background color */
            z-index: 4; /* Ensure the box appears above other elements */
        }

        /* Body styles */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background-color: #141d2c; /* Background color of the whole page */
        }
        .made-by {
    position: absolute;
    top: 10;
    right: 165;
    font-family: Averta;
    font-size: 20px;
    color: #828282;
}

.not-replacement {
    position: absolute;
    top: 35px;
    right: 12;
    font-family: Averta;
    font-size: 20px;
    color: #828282;
}

        /* Iframe container */
        .iframe-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }
        .iframe-container iframe {
            width: 1080px;
            height: 1920px;
            border: none;
        }

        /* Text styles */
        .time {
            position: absolute;
            left: 30px; /* Start 30 pixels from the very left */
            top: 100px; /* 100 pixels from the very top */
            font-family: 'Averta', sans-serif; /* Specify the font */
            font-size: 35px; /* Text size */
            color: white;
            white-space: nowrap; /* Prevent wrapping */
            width: calc(100% - 30px); /* Stretch across to the very right */
        }
        .time div {
            display: inline-block;
            padding-right: 50px; /* Adjust the spacing between words */
        }
        .line {
            position: absolute;
            top: 155px; /* 10 pixels underneath the 'time' text box */
            left: 0; /* Start from the very left */
            width: 100%; /* Stretch across the entire width */
            height: 3px; /* Medium thickness */
            background-color: #FF4713; /* Orange color */
        }
.live-train-services {
    position: absolute;
    top: 160px; /* Adjust based on your layout */
    left: 0;
    width: 100%;
    padding: 20px;
    color: white;
    font-family: 'Averta', sans-serif;
    font-size: 50px; /* Adjusted text size */
    padding-left: 0; /* Adjusted padding-left */
}
        .live-train-services ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
.live-train-services li {
    margin-bottom: 10px; /* Increased margin bottom */
    padding-bottom: 70px;
    border-bottom: 3px solid white;
    display: flex; /* Use flexbox */
}
        .live-train-services li div {
            flex: 1; /* Distribute equal space */
        }

        .live-train-services li .destination {
            position: absolute;
            text-align: left;
            left: 202.5px; /* Adjust left position for positioning */
            width: calc(100% - 170px); /* Decrease width of container */
            white-space: nowrap;
            overflow: hidden;
        }


        .live-train-services li .platform {
            position: absolute;
            text-align: right;
            right: 860px; /* Adjust right position for positioning */
            width: 100px; /* Adjust width as needed */
            white-space: nowrap;
            overflow: hidden;
        }

        .live-train-services li .status {
            position: absolute;
            text-align: right;
            right: 572.5px; /* Adjust right position for positioning */
            color: white;
        }

.live-train-services li .operator {
    position: relative;
    text-align: left;
    left: -757.5px; /* Start 25 pixels from the very left */
    top: 60px; /* Maintain the same position */
    white-space: nowrap;
    overflow: visible; /* Change overflow to visible */
    font-family: 'Thin Averta', sans-serif;
}

        .live-train-services li .std {
    position: absolute;
    text-align: left;
    left: 30px; /* Adjust left position for positioning */
    width: calc(100% - 170px); /* Decrease width of container */
    white-space: nowrap;
    overflow: hidden;
}

.nrccMessage {
    position: absolute;
    bottom: -150px; /* Align with the bottom of the iframe */
    font-family: 'Averta', sans-serif; /* Specify the font */
    color: white;
    height: 250px; /* Set height to 250 pixels */
    font-size: 75px; /* Set the font size */
    white-space: nowrap; /* Prevent text from wrapping */
    overflow: hidden; /* Hide overflow content */
    width: auto; /* Set width to auto to adjust based on content */
    animation: scrollText 20s linear infinite; /* Define animation */
    z-index: 1; /* Bring the text box to the front */
}

@keyframes scrollText {
    0% { transform: translateX(30%); } /* Start off screen to the right */
    100% { transform: translateX(-100%); } /* Scroll off screen to the left */
}

        /* Orange box */
        .orange-box {
            position: absolute;
            bottom: 0; /* Start at the very bottom */
            left: 0; /* Align with the left side of the iframe */
            height: 95px; /* Set the height to 50 pixels */
            width: 100%; /* Make it span the entire width of the iframe */
            background-color: #FF4713; /* Change the background color */
        }

        /* Station selection styles */
        .station-selection {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            z-index: 999;
            transition: opacity 0.3s ease-in-out;
            text-align: center; /* Center align text */
        }

        .station-selection.hide {
            opacity: 0;
            pointer-events: none;
        }

        /* Image styles */
        .logo {
            position: absolute;
            left: 35px; /* 35 pixels from the very left */
            top: 17.5px; /* 10 pixels from the very top */
            height: 65px; /* Set height to 50 pixels */
        }
    </style>
</head>
<body>

    <div class="red-box"></div>
    <div class="made-by">Made by Michael</div>
    <div class="not-replacement">Not a substitute for real-time info.</div>


    <!-- Text boxes -->
    <div class="text-box">Departures</div>
    <div class="nrccMessage" style="left: 0;">If you see something that doesn't look right, speak to station staff or text the British Transport Police on 61016. See it - Say it - Sorted.</div>

    <div class="time">
        <div>Time</div>
        <div style="padding-left: 35px;">Destination</div>
        <div style="padding-left: 500px;">Platform</div>
        <div style="padding-left: 125px;">Status</div>
        <div style="padding-left: 0px;">Facilities & Reservations</div>
    </div>

    <!-- Line -->
    <div class="line"></div>

    <!-- Live train services section -->
    <div class="live-train-services" id="liveTrainServices">
        <ul id="liveTrainList"></ul>
    </div>

    <!-- Orange box -->
    <div class="orange-box"></div>
    <div class="alert-text" id="scrollingText"></div>

    <!-- Clock -->
    <div class="clock">00:00:00</div>

    <!-- Box -->
    <div class="box"></div>

    <div class="text-box">Departures</div>

    <!-- Image -->
    <img class="logo" src="https://github.com/MichaelH12345/fonts/raw/main/download%20(1).png" alt="Logo">

    <!-- Station selection -->
    <div class="station-selection" id="stationSelection">
        <label for="station" style="font-family: 'Averta', sans-serif; font-size: 75px; color:#141d2c;">Choose a UK Station:</label>
        <input type="text" id="station" name="station" style="font-family: 'Averta', sans-serif; font-size: 60px; color:#141d2c;" placeholder="Enter station name...">
        <button onclick="fetchLiveTrainServices()" style="font-family: 'Averta', sans-serif; font-size: 60px; color:#141d2c;">Enter</button>
    </div>

<script>
// Fetch and display live train services based on user input
async function fetchLiveTrainServices() {
    const stationInput = document.getElementById('station').value;
    if (stationInput) {
        await fetchAndDisplayLiveTrainServices(stationInput);
        setInterval(() => fetchAndDisplayLiveTrainServices(stationInput), 15000); // Update every 10 minutes
        document.getElementById('stationSelection').classList.add('hide'); // Hide station selection
        updateClock(); // Start the clock
    } else {
        console.error('Please select a station.');
    }
}

// Function to fetch live train services and display them
async function fetchAndDisplayLiveTrainServices(station) {
    try {
        const response = await fetch(`https://national-rail-api.davwheat.dev/staffdepartures/${station}?expand=true`);
        const data = await response.json();
        const trainServices = data.trainServices;

        // Fetch delay and cancellation reasons for all services concurrently
        const delayReasonPromises = trainServices.map(service => getDelayReason(service.delayReason));
        const cancelReasonPromises = trainServices.map(service => getCancelReason(service.cancelReason));
        const delayReasons = await Promise.all(delayReasonPromises);
        const cancelReasons = await Promise.all(cancelReasonPromises);

        // Assign delay and cancellation reasons to train services
        trainServices.forEach((service, index) => {
            service.delayReason = delayReasons[index];
            service.cancelReason = cancelReasons[index];
        });

        // Sort train services based on scheduled departure time (std)
        trainServices.sort((a, b) => {
            const stdA = a.std ? a.std : '00:00';
            const stdB = b.std ? b.std : '00:00';
            return stdA.localeCompare(stdB);
        });

        // Display sorted live train services
        displayLiveTrainServices(trainServices);
    } catch (error) {
        console.error('Error fetching and displaying live train services:', error);
    }
}

// Function to display live train services
function displayLiveTrainServices(trainServices) {
    const liveTrainList = document.getElementById('liveTrainList');
    liveTrainList.innerHTML = ''; // Clear existing data

    if (trainServices.length === 0) {
        // If no live train services available
        liveTrainList.innerHTML = "<li>No live train services available.</li>";
    } else {
        trainServices.forEach(service => {
            const listItem = createListItem(service);
            liveTrainList.appendChild(listItem);
        });
    }
}

// Create list item for a train service
function createListItem(service) {
    // Construct list item HTML
    const listItem = document.createElement('li');
    const destination = service.destination[0].locationName;
    const platform = service.platform || '-';
    const operator = service.operator ? service.operator : '-';
    const std = service.std ? formatDepartureTime(service.std) : '-';
    const etd = service.etd ? formatDepartureTime(service.etd) : '-';
    const status = getStatus(service);
    const color = getStatusColor(service);

    listItem.innerHTML = `
        <div class="std">${std}</div>
        <div class="destination">${destination}</div>
        <div class="platform">${platform}</div>
        <div class="status" style="color: ${color};">${status}</div>
        <div class="reason">${service.isCancelled ? service.cancelReason : service.delayReason}</div>
    `;

    return listItem;
}

// Function to get status of a train service
function getStatus(service) {
    if (service.isCancelled) {
        return 'Cancelled';
    } else if (service.etd === '00:00') {
        return 'Delayed';
    } else {
        return service.etd ? formatDepartureTime(service.etd) : 'On Time';
    }
}

// Function to get color for status of a train service
function getStatusColor(service) {
    if (service.isCancelled) {
        return '#FF4713'; // Orange for Cancelled
    } else {
        return 'white'; // White for others
    }
}

// Initial call to update the clock
updateClock();

// Set interval to update the clock every second
setInterval(updateClock, 1000);

// Initially show station selection
window.onload = function() {
    document.getElementById('stationSelection').classList.remove('hide');
};
</script>

</body>
</html>
