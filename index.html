<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-ascale=1.0">
    <title>Background Iframe</title>
    <style>
        /* Font imports */
        @font-face {
            font-family: 'AvertaBold';
            src: url('https://raw.githubusercontent.com/MichaelH12345/Avanti_Departures/main/AvertaBold.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'Averta';
            src: url('https://raw.githubusercontent.com/MichaelH12345/Avanti_Departures/main/Averta.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'Thin Averta';
            src: url('https://raw.githubusercontent.com/MichaelH12345/fonts/main/averta_bigfontsite.com.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'Operator Font';
            src: url('https://raw.githubusercontent.com/MichaelH12345/Avanti_Departures/main/Averta.ttf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

        /* Clock styles */
        .clock {
            position: absolute;
            bottom: -0.5px; /* 3 pixels from the bottom */
            right: 35px; /* 35 pixels from the right */
            font-family: 'AvertaBold', sans-serif;
            font-size: 80px;
            color: white;
            z-index: 5; /* Ensure the clock appears above other elements */
        }

/* Text box for Departures */
.text-box {
    position: absolute;
    left: 90px; /* Start 60 pixels from the very left */
    top: 5px; /* 5 pixels from the very top */
    font-family: 'AvertaBold', sans-serif; /* Specify the font */
    font-size: 70px; /* Text size */
    color: white;
    height: auto; /* Set height to auto initially */
}


        

        /* Box styles */
        .box {
            position: absolute;
            bottom: 0; /* Start from the very bottom */
            right: 20; /* Start from the very right */
            height: 95px;
            width: 350px;
            background-color: #141d2c; /* Background color */
            z-index: 4; /* Ensure the clock appears above other elements */
        }

/* Red box styles */
.red-box {
    position: absolute;
    bottom: 0; /* Start from the very bottom */
    right: 0; /* Start from the very right */
    height: 95px;
    width: 50px; /* Set width to 50 pixels */
    background-color: #FF4713; /* Red background color */
    z-index: 4; /* Ensure the box appears above other elements */
}

        /* Body styles */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background-color: #141d2c; /* Background color of the whole page */
        }

        /* Iframe container */
        .iframe-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }
        .iframe-container iframe {
            width: 1080px;
            height: 1920px;
            border: none;
        }

        /* Text styles */
        .time {
            position: absolute;
            left: 30px; /* Start 30 pixels from the very left */
            top: 100px; /* 100 pixels from the very top */
            font-family: 'Averta', sans-serif; /* Specify the font */
            font-size: 35px; /* Text size */
            color: white;
            white-space: nowrap; /* Prevent wrapping */
            width: calc(100% - 30px); /* Stretch across to the very right */
        }
        .time div {
            display: inline-block;
            padding-right: 50px; /* Adjust the spacing between words */
        }
        .line {
            position: absolute;
            top: 155px; /* 10 pixels underneath the 'time' text box */
            left: 0; /* Start from the very left */
            width: 100%; /* Stretch across the entire width */
            height: 3px; /* Medium thickness */
            background-color: #FF4713; /* Orange color */
        }

        /* Live train services */
        .live-train-services {
            position: absolute;
            top: 160px; /* Adjust based on your layout */
            left: 0;
            width: 100%;
            padding: 20px;
            color: white;
            font-family: 'Averta', sans-serif;
            font-size: 50px; /* Adjusted text size */
        }
        .live-train-services ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
.live-train-services li {
    margin-bottom: 10px; /* Increased margin bottom */
    padding-bottom: 70px;
    border-bottom: 3px solid white;
    display: flex; /* Use flexbox */
    left: 0; /* Start from the very left */
}

        .live-train-services li div {
            flex: 1; /* Distribute equal space */
        }

        .live-train-services li .destination {
            position: absolute;
            text-align: left;
            left: 205px; /* Adjust left position for positioning */
            width: calc(100% - 170px); /* Decrease width of container */
            white-space: nowrap;
            overflow: hidden;
        }


        .live-train-services li .platform {
            position: absolute;
            text-align: right;
            right: 875px; /* Adjust right position for positioning */
            width: 100px; /* Adjust width as needed */
            white-space: nowrap;
            overflow: hidden;
        }

        .live-train-services li .status {
            position: absolute;
            text-align: right;
            right: 595px; /* Adjust right position for positioning */
            color: white;
        }

.live-train-services li .operator {
    position: relative;
    text-align: left;
    right: 455px;
    top: 60px; /* Move down by 50px */
    white-space: nowrap;
    overflow: show; /* Display overflowing content */
    font-family: 'Thin Averta', sans-serif; /* Change font to Thin Averta */
}


.nrccMessage {
    position: absolute;
    left: 0; /* Start from the very left */
    bottom: 5; /* Align with the bottom of the iframe */
    font-family: 'Averta', sans-serif; /* Specify the font */
    color: white;
    height: 95px; /* Set height to 95 pixels */
    width: auto; /* Allow text box width to adjust based on content */
    font-size: 75px; /* Set the font size */
    white-space: nowrap; /* Prevent text from wrapping */
    overflow: hidden; /* Hide overflow content */
    animation: scrollText 20s linear infinite; /* Define animation */
    z-index: 1; /* Bring the text box to the front */
}

@keyframes scrollText {
    0% { transform: translateX(100%); } /* Start off screen to the right */
    100% { transform: translateX(-100%); } /* Scroll to off screen to the left */
}


        /* Orange box */
        .orange-box {
            position: absolute;
            bottom: 0; /* Start at the very bottom */
            left: 0; /* Align with the left side of the iframe */
            height: 95px; /* Set the height to 50 pixels */
            width: 100%; /* Make it span the entire width of the iframe */
            background-color: #FF4713; /* Change the background color */
        }

        /* Station selection styles */
.station-selection {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(255, 255, 255, 0.9);
    padding: 20px;
    border-radius: 10px;
    z-index: 999;
    transition: opacity 0.3s ease-in-out;
    text-align: center; /* Center align text */
}

        .station-selection.hide {
            opacity: 0;
            pointer-events: none;
        }

        /* Image styles */
        .logo {
            position: absolute;
            left: 35px; /* 35 pixels from the very left */
            top: 17.5px; /* 10 pixels from the very top */
            height: 65px; /* Set height to 50 pixels */
        }
    </style>
</head>
<body>

    <div class="red-box"></div>


    <!-- Text boxes -->
    <div class="text-box">Departures</div>
    
<div class="nrccMessage" style="left: 0;">If you see something that doesn't look right, speak to station staff or text the British Transport Police on 61016. See it - Say it - Sorted.</div>


    <div class="time">
        <div>Time</div>
        <div style="padding-left: 35px;">Destination</div>
        <div style="padding-left: 500px;">Platform</div>
        <div style="padding-left: 125px;">Status</div>
        <div style="padding-left: 0px;">Facilities & Reservations</div>
    </div>

    <!-- Line -->
    <div class="line"></div>

    <!-- Live train services section -->
    <div class="live-train-services" id="liveTrainServices">
        <ul id="liveTrainList"></ul>
    </div>

    <!-- Orange box -->
    <div class="orange-box"></div>
    <div class="alert-text" id="scrollingText"></div>

    <!-- Clock -->
    <div class="clock">00:00:00</div>


    <!-- Box -->
    <div class="box"></div>


    <div class="text-box">Departures</div>

     <!-- Image -->
    <img class="logo" src="https://github.com/MichaelH12345/fonts/raw/main/download%20(1).png" alt="Logo">


<!-- Station selection -->
<div class="station-selection" id="stationSelection">
    <label for="station" style="font-family: 'Averta', sans-serif; font-size: 75px; color:#141d2c;">Choose a UK Station:</label>
    <input type="text" id="station" name="station" style="font-family: 'Averta', sans-serif; font-size: 60px; color:#141d2c;" placeholder="Enter station name...">
    <button onclick="fetchLiveTrainServices()" style="font-family: 'Averta', sans-serif; font-size: 60px; color:#141d2c;">Enter</button>
</div>


<script>
    async function fetchAndDisplayLiveTrainServices(station) {
        try {
            const response = await fetch(`https://national-rail-api.davwheat.dev/staffdepartures/${station}?expand=true`);
            const data = await response.json();
            const trainServices = data.trainServices;

            const liveTrainList = document.getElementById('liveTrainList');
            liveTrainList.innerHTML = ''; // Clear existing data

            if (trainServices.length === 0) {
                // If no live train services available
                liveTrainList.innerHTML = "<li>No live train services available.</li>";
            } else {
                // Generate and append live train service list items
                trainServices.forEach(service => {
                    const listItem = document.createElement('li');
                    const destination = service.destination[0].locationName;
                    const platform = service.platform || '-';
                    const operator = service.operator ? service.operator : '-';

                    // Extracting time from std and etd fields
                    const std = service.std ? formatDepartureTime(service.std) : '-';
                    const atd = service.atd ? formatDepartureTime(service.atd) : '-';
                    const etd = service.etd ? formatDepartureTime(service.etd) : '-';

                    // Determine status based on cancellation status and ATD vs STD
                    let status;
                    let color; // Variable to store text color
                    let reason = ''; // Variable to store delay reason
                    if (service.isCancelled) {
                        status = 'Cancelled';
                        color = '#FF4713'; // Set text color to orange for Cancelled status
                    } else if (etd === '00:00') {
                        status = 'Delayed';
                        color = 'white'; // Set text color to white for Delayed status
                        reason = getDelayReason(service.delayReason);
                    } else if (std === etd) {
                        status = 'On Time';
                        color = 'white'; // Set text color to white for On Time status
                    } else {
                        status = etd;
                        color = 'white'; // Set text color to white for other statuses
                    }

                    // Update the clock every second
                    function updateClock() {
                        const now = new Date();
                        const hours = String(now.getHours()).padStart(2, '0');
                        const minutes = String(now.getMinutes()).padStart(2, '0');
                        const seconds = String(now.getSeconds()).padStart(2, '0');
                        const timeString = `${hours}:${minutes}:${seconds}`;
                        document.querySelector('.clock').textContent = timeString;
                    }

                    // Initial call to update the clock
                    updateClock();

                    // Set interval to update the clock every second
                    setInterval(updateClock, 1000);

                    listItem.innerHTML = `
                        <div>${std}</div>
                        <div class="destination">${destination}</div>
                        <div class="platform">${platform}</div>
                        <div class="status" style="color: ${color};">${status}</div>
                        <div class="operator">${operator}</div>
                        <div class="reason">${reason}</div>
                    `;

                    liveTrainList.appendChild(listItem);
                });

                // Show the station name once the user chooses a station
                const stationNameBox = document.createElement('div');
                stationNameBox.classList.add('text-box');
                stationNameBox.style.left = '460px'; // Move it to the left by 10 pixels
                stationNameBox.style.top = '35px'; // Maintain the top position
                stationNameBox.style.fontFamily = 'Averta, sans-serif'; // Use Thin Averta font
                stationNameBox.style.fontSize = '35px'; // Text size
                stationNameBox.style.color = 'white'; // Text color
                stationNameBox.style.height = 'auto'; // Set height to auto initially
                stationNameBox.textContent = `(from ${data.locationName})`; // Station name in brackets
                document.body.appendChild(stationNameBox);
            }
        } catch (error) {
            console.error('Error fetching live train services:', error);
        }
    }

    // Function to format departure time
    function formatDepartureTime(timeString) {
        return timeString.slice(11, 16);
    }

    // Function to get delay reason
    function getDelayReason(reasonCode) {
        // Replace with actual logic to get delay reason from provided JSON file
        // For now, return an empty string
        return '';
    }

    // Function to fetch live train services based on user input
    function fetchLiveTrainServices() {
        const stationInput = document.getElementById('station').value;
        if (stationInput) {
            fetchAndDisplayLiveTrainServices(stationInput);
            setInterval(() => fetchAndDisplayLiveTrainServices(stationInput), 15000); // Update every minute (60,000 milliseconds)
            document.getElementById('stationSelection').classList.add('hide'); // Hide station selection
        } else {
            console.error('Please select a station.');
        }
    }


    // Fetch and display live train services initially and then every minute
    window.onload = function() {
        // Initially show station selection
        document.getElementById('stationSelection').classList.remove('hide');
    };
</script>

</body>
</html>
